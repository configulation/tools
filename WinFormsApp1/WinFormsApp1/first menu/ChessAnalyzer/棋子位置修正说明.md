# 棋子位置修正说明

## 🎯 核心问题

**PictureBox.Location 是左上角坐标，不是中心点！**

## ❌ 修正前（错误）

```
交叉点 (5, 5)
    ●
    ┌─────────┐
    │  ♜ 棋子 │  ← Location = (5, 5)
    │  圆心   │  ← 圆心在 (5+14, 5+12.5) = (19, 17.5)
    └─────────┘
```

**结果：棋子圆心偏离交叉点，位于方格中央！**

---

## ✅ 修正后（正确）

```
交叉点 (5, 5)
       ●
    ┌─────────┐
    │  ♜ 棋子 │  ← Location = (5-14, 5-12.5) = (-9, -7.5)
    │  圆心●  │  ← 圆心在 (5, 5)，与交叉点重合！
    └─────────┘
```

**结果：棋子圆心精确对准交叉点！**

---

## 🔧 代码修正

### 修正前
```csharp
// ❌ 错误：直接用交叉点坐标作为 Location
Location = new Point(5 + x * 33, 5 + y * 27)
```

**问题：** `Location` 是 PictureBox 的**左上角**，导致棋子圆心偏移到方格中央。

### 修正后
```csharp
// ✅ 正确：减去半径，让圆心对准交叉点
int intersectionX = 5 + x * 33;  // 交叉点 X
int intersectionY = 5 + y * 27;  // 交叉点 Y
int pieceWidth = 28;
int pieceHeight = 25;

Location = new Point(
    intersectionX - pieceWidth / 2,   // 左上角 X = 交叉点 X - 半宽
    intersectionY - pieceHeight / 2   // 左上角 Y = 交叉点 Y - 半高
)
```

**效果：** 棋子圆心 = `(左上角 + 半径)` = `(交叉点 - 半径 + 半径)` = **交叉点** ✅

---

## 📐 坐标计算详解

### 交叉点坐标
```
第 x 列，第 y 行的交叉点：
X = 5 + x × 33  (x: 0~8)
Y = 5 + y × 27  (y: 0~9)
```

### 棋子尺寸
```
宽度 = 28 像素
高度 = 25 像素
半宽 = 14 像素
半高 = 12.5 像素
```

### PictureBox 左上角
```
Left = 交叉点 X - 半宽 = (5 + x × 33) - 14
Top  = 交叉点 Y - 半高 = (5 + y × 27) - 12.5
```

### 棋子圆心（验证）
```
圆心 X = Left + 半宽 = (5 + x × 33 - 14) + 14 = 5 + x × 33 ✅
圆心 Y = Top + 半高 = (5 + y × 27 - 12.5) + 12.5 = 5 + y × 27 ✅
```

**圆心与交叉点完美重合！**

---

## 🎯 九宫格斜线验证

### 九宫格交叉点
```
上方九宫格：
  (3,0) ●─────● (5,0)
        │  ×  │
  (3,2) ●─────● (5,2)

下方九宫格：
  (3,7) ●─────● (5,7)
        │  ×  │
  (3,9) ●─────● (5,9)
```

### 斜线绘制
```csharp
// 上方九宫格斜线
g.DrawLine(pen, 5 + 3 * 33, 5, 5 + 5 * 33, 5 + 2 * 27);      // 左上→右下
g.DrawLine(pen, 5 + 5 * 33, 5, 5 + 3 * 33, 5 + 2 * 27);      // 右上→左下

// 下方九宫格斜线
g.DrawLine(pen, 5 + 3 * 33, 5 + 7 * 27, 5 + 5 * 33, 5 + 9 * 27);  // 左上→右下
g.DrawLine(pen, 5 + 5 * 33, 5 + 7 * 27, 5 + 3 * 33, 5 + 9 * 27);  // 右上→左下
```

### 士（仕）的位置
```
黑方士（初始）：(3,0), (5,0)
红方仕（初始）：(3,9), (5,9)
```

**现在棋子圆心在交叉点上，士/仕的走法斜线应该清晰可见！**

---

## ✅ 测试验证

### 1. 初始棋盘
加载标准开局 FEN，检查：
- ✅ 帅/将 在 (4, 0) 和 (4, 9)
- ✅ 士/仕 在 (3,0), (5,0), (3,9), (5,9)
- ✅ 九宫格斜线清晰可见
- ✅ 所有棋子圆心在交叉点上

### 2. 士的走法
手动移动士，验证：
- ✅ 从 (3,0) 走到 (4,1) - 沿斜线
- ✅ 从 (4,1) 走到 (5,0) - 沿斜线
- ✅ 斜线不被遮挡

---

## 📊 修正效果对比

| 项目 | 修正前 ❌ | 修正后 ✅ |
|------|----------|----------|
| 棋子圆心位置 | 方格中央 | 交叉点上 |
| 九宫格斜线 | 可能被遮挡 | 清晰可见 |
| 士/仕走法 | 不符合规则 | 符合规则 |
| 视觉效果 | 不标准 | 标准棋盘 |

---

## 🎉 总结

**关键修正：**
```csharp
// 错误：Location = 交叉点坐标 ❌
Location = new Point(5 + x * 33, 5 + y * 27)

// 正确：Location = 交叉点坐标 - 棋子半径 ✅
Location = new Point(
    (5 + x * 33) - pieceWidth / 2,
    (5 + y * 27) - pieceHeight / 2
)
```

**现在棋子圆心精确对准交叉点，九宫格斜线清晰可见！** ✅
